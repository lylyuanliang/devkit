# Kafka Client - 功能详细规划

## 功能模块总览

### 阶段 1: 核心功能（MVP）
- [x] 项目规划和架构设计
- [ ] 连接管理
- [ ] 主题浏览
- [ ] 简单的消息生产
- [ ] 简单的消息消费

### 阶段 2: 增强功能
- [ ] 消费组管理
- [ ] 消息模板
- [ ] 消息搜索和过滤
- [ ] 数据导出

### 阶段 3: 高级功能
- [ ] 监控和统计
- [ ] Schema Registry 集成
- [ ] 多语言支持
- [ ] 暗黑模式

---

## 详细功能说明

## 1. 连接管理

### 1.1 连接列表
**功能描述**: 
- 显示所有已保存的 Kafka 连接
- 显示连接状态（已连接/未连接）
- 快速切换当前连接

**UI 设计**:
```
┌─────────────────────────────────────┐
│ 连接管理                             │
├─────────────────────────────────────┤
│ [+新建连接]                          │
│                                      │
│ ● Local Kafka (已连接)               │
│   localhost:9092                     │
│   [测试] [编辑] [删除]                │
│                                      │
│ ○ Production Kafka                   │
│   kafka1.prod.com:9092               │
│   [连接] [编辑] [删除]                │
└─────────────────────────────────────┘
```

**数据结构**:
```typescript
interface Connection {
  id: string;
  name: string;
  brokers: string[];
  clientId?: string;
  sasl?: SASlConfig;
  ssl?: SSLConfig;
  connectionTimeout?: number;
  requestTimeout?: number;
  createdAt: Date;
  updatedAt: Date;
}
```

### 1.2 新建/编辑连接
**表单字段**:
- 连接名称（必填）
- Broker 地址列表（必填）
  - 支持多个 broker，逗号分隔
  - 格式: host:port
- Client ID（可选）
- 认证配置（可选）
  - 认证类型: None / SASL/PLAIN / SASL/SCRAM-SHA-256 / SASL/SCRAM-SHA-512
  - 用户名
  - 密码
- SSL 配置（可选）
  - 启用 SSL
  - CA 证书
  - 客户端证书
  - 客户端密钥
- 高级设置
  - 连接超时
  - 请求超时

**验证规则**:
- 连接名称不能为空
- 至少一个 broker 地址
- Broker 地址格式验证
- 如果启用 SASL，用户名和密码必填

**功能**:
- 测试连接按钮
- 保存连接配置
- 密码安全存储（使用 safeStorage）

### 1.3 连接测试
**测试流程**:
1. 验证 broker 地址格式
2. 尝试建立连接
3. 获取集群元数据
4. 显示测试结果

**测试结果显示**:
```
✓ 连接成功
  - Broker 数量: 3
  - 控制器 ID: 1
  - 集群 ID: cluster-123
  - 响应时间: 45ms
```

---

## 2. 主题管理

### 2.1 主题列表
**功能描述**:
- 显示当前连接的所有主题
- 支持搜索和过滤
- 显示主题基本信息

**列表字段**:
- 主题名称
- 分区数
- 副本因子
- 消息总数（估计）
- 最后更新时间

**操作**:
- 查看详情
- 发送消息
- 消费消息
- 删除主题

**UI 设计**:
```
┌────────────────────────────────────────────────────────┐
│ 主题列表                    [搜索框]  [+创建主题]       │
├────────────────────────────────────────────────────────┤
│ 名称          分区  副本  消息数    操作                │
│ user-events    3    2    10,245   [详情][消费][删除]   │
│ order-created  6    3    52,100   [详情][消费][删除]   │
│ payment-log    3    2     8,523   [详情][消费][删除]   │
└────────────────────────────────────────────────────────┘
```

### 2.2 主题详情
**信息展示**:
- **基本信息**
  - 主题名称
  - 分区数量
  - 副本因子
  - 内部主题标识
  
- **分区详情**（表格形式）
  - 分区 ID
  - Leader
  - Replicas
  - ISR
  - Offset 范围（最早、最新）

- **配置信息**
  - retention.ms
  - retention.bytes
  - segment.bytes
  - cleanup.policy
  - compression.type
  - 等其他配置项

**操作**:
- 编辑配置
- 增加分区
- 删除主题

### 2.3 创建主题
**表单字段**:
- 主题名称（必填）
  - 命名规则验证: ^[a-zA-Z0-9._-]+$
- 分区数（必填，默认: 1）
- 副本因子（必填，默认: 1）
- 配置项（可选）
  - retention.ms
  - retention.bytes
  - cleanup.policy
  - compression.type
  - max.message.bytes

**验证**:
- 主题名称不能为空
- 分区数 >= 1
- 副本因子 <= broker 数量
- 主题名称不能重复

### 2.4 删除主题
**确认对话框**:
```
⚠️ 删除主题

确定要删除主题 "user-events" 吗？

此操作将删除主题的所有数据，且不可恢复。

请输入主题名称以确认: [___________]

[取消]  [确定删除]
```

---

## 3. 消息生产

### 3.1 发送单条消息
**功能描述**:
- 向指定主题发送消息
- 支持多种消息格式
- 可自定义 Key、Headers、Partition

**UI 设计**:
```
┌────────────────────────────────────────┐
│ 发送消息                                │
├────────────────────────────────────────┤
│ 主题: [user-events ▼]                  │
│                                         │
│ Key (可选):                             │
│ [user-123                            ] │
│                                         │
│ Headers (可选):                         │
│ [+ 添加 Header]                         │
│ │ trace-id: abc-123    [删除]          │
│                                         │
│ 分区策略:                               │
│ ( ) 自动  (●) 指定分区 [2 ▼]            │
│                                         │
│ 消息格式: [JSON ▼]                      │
│                                         │
│ 消息内容:                               │
│ ┌────────────────────────────────────┐ │
│ │ {                                  │ │
│ │   "userId": "user-123",           │ │
│ │   "action": "login",              │ │
│ │   "timestamp": 1234567890         │ │
│ │ }                                  │ │
│ └────────────────────────────────────┘ │
│                                         │
│ [清空]  [从模板加载]  [保存为模板]  [发送] │
└────────────────────────────────────────┘
```

**支持的消息格式**:
- JSON（自动验证格式）
- 纯文本
- Avro（需要 Schema Registry）
- Base64（二进制数据）

**Headers 管理**:
- 添加多个 header
- Key-Value 对
- 删除 header

### 3.2 批量发送消息
**功能描述**:
- 一次发送多条消息
- 支持从文件导入
- 显示发送进度

**导入格式**:
- JSON Lines（每行一个 JSON 对象）
- CSV（指定字段映射）
- JSON 数组

**示例**:
```json
{"key": "1", "value": {"name": "Alice"}}
{"key": "2", "value": {"name": "Bob"}}
{"key": "3", "value": {"name": "Charlie"}}
```

**UI**:
```
┌────────────────────────────────────────┐
│ 批量发送消息                            │
├────────────────────────────────────────┤
│ 主题: [user-events ▼]                  │
│                                         │
│ 导入文件: [选择文件]                    │
│ 文件格式: [JSON Lines ▼]               │
│                                         │
│ 预览 (前 5 条):                         │
│ ┌────────────────────────────────────┐ │
│ │ 1. {"userId": "1", "name": "Alice"}│ │
│ │ 2. {"userId": "2", "name": "Bob"}  │ │
│ │ ...                                │ │
│ └────────────────────────────────────┘ │
│                                         │
│ 总计: 1000 条消息                       │
│                                         │
│ 进度: [████████████---------] 60%      │
│ 已发送: 600/1000                        │
│                                         │
│ [取消]  [开始发送]                      │
└────────────────────────────────────────┘
```

### 3.3 消息模板
**功能描述**:
- 保存常用的消息模板
- 快速加载模板
- 模板管理

**模板结构**:
```typescript
interface MessageTemplate {
  id: string;
  name: string;
  topic: string;
  key?: string;
  headers?: Record<string, string>;
  value: string;
  format: 'json' | 'text' | 'avro';
  createdAt: Date;
}
```

**UI**:
```
┌────────────────────────────────────────┐
│ 消息模板                                │
├────────────────────────────────────────┤
│ [+ 新建模板]                [搜索框]    │
│                                         │
│ ● User Login Event                      │
│   主题: user-events                     │
│   [使用] [编辑] [删除]                  │
│                                         │
│ ● Order Created                         │
│   主题: order-created                   │
│   [使用] [编辑] [删除]                  │
└────────────────────────────────────────┘
```

---

## 4. 消息消费

### 4.1 实时消费
**功能描述**:
- 实时订阅主题消息
- 消息实时展示
- 支持暂停/继续

**UI 设计**:
```
┌────────────────────────────────────────────────────────┐
│ 消费消息                                                │
├────────────────────────────────────────────────────────┤
│ 主题: [user-events ▼]    分区: [全部 ▼]                │
│                                                         │
│ 消费选项:                                               │
│ (●) 最新消息  ( ) 最早消息  ( ) 指定 Offset            │
│                                                         │
│ [开始消费]  [暂停]  [停止]  [清空]  [导出]              │
│                                                         │
│ 消息列表: (已接收 234 条)                  [自动滚动 ✓] │
│ ┌──────────────────────────────────────────────────────┐│
│ │ ▼ Offset: 1234  Partition: 2  Time: 10:23:45        ││
│ │   Key: user-123                                      ││
│ │   Headers: trace-id: abc-123                         ││
│ │   Value:                                             ││
│ │   {                                                  ││
│ │     "userId": "user-123",                            ││
│ │     "action": "login"                                ││
│ │   }                                                  ││
│ │                                                      ││
│ │ ▼ Offset: 1235  Partition: 1  Time: 10:23:46        ││
│ │   ...                                                ││
│ └──────────────────────────────────────────────────────┘│
└────────────────────────────────────────────────────────┘
```

**消息展示**:
- Offset
- Partition
- 时间戳
- Key
- Headers
- Value（格式化显示）

**功能**:
- 开始/暂停/停止消费
- 自动滚动到最新消息
- 展开/折叠消息详情
- 复制消息内容
- 过滤消息

### 4.2 历史消息查看
**功能描述**:
- 从指定 offset 开始消费
- 分页加载历史消息
- 跳转到指定 offset

**UI**:
```
┌────────────────────────────────────────┐
│ 历史消息查看                            │
├────────────────────────────────────────┤
│ 主题: user-events                       │
│ 分区: [2 ▼]                             │
│                                         │
│ Offset 范围:                            │
│ 最早: 0      最新: 10,245               │
│                                         │
│ 起始 Offset: [1000      ]               │
│ 加载数量: [100 ▼]                       │
│                                         │
│ [加载消息]                              │
│                                         │
│ 消息列表: (1000-1099)                   │
│ [上一页] 第 11/103 页 [下一页]          │
└────────────────────────────────────────┘
```

### 4.3 消息过滤和搜索
**过滤条件**:
- Key 匹配（正则表达式）
- Value 内容搜索（全文搜索）
- Header 过滤
- 时间范围
- 分区过滤

**UI**:
```
┌────────────────────────────────────────┐
│ 消息过滤                                │
├────────────────────────────────────────┤
│ Key 匹配:                               │
│ [user-.*          ] (正则)              │
│                                         │
│ Value 包含:                             │
│ [login            ]                     │
│                                         │
│ 时间范围:                               │
│ 从: [2024-01-01 00:00] 到: [现在]       │
│                                         │
│ 分区: [全部 ▼]                          │
│                                         │
│ [应用过滤]  [重置]                      │
└────────────────────────────────────────┘
```

### 4.4 消息导出
**导出格式**:
- JSON
- JSON Lines
- CSV
- 纯文本

**导出选项**:
- 导出全部/当前页/选中消息
- 包含/不包含元数据（offset、partition 等）
- 自定义字段

---

## 5. 消费组管理

### 5.1 消费组列表
**功能描述**:
- 显示所有消费组
- 显示消费组状态
- 显示总体 Lag

**UI**:
```
┌────────────────────────────────────────────────────────┐
│ 消费组管理                              [刷新]          │
├────────────────────────────────────────────────────────┤
│ 消费组名称           状态      成员数  总Lag   操作     │
│ my-consumer-group   STABLE     3      1,234  [详情]    │
│ analytics-service   STABLE     5        456  [详情]    │
│ dead-consumer       DEAD       0      5,678  [详情]    │
└────────────────────────────────────────────────────────┘
```

### 5.2 消费组详情
**信息展示**:
- **基本信息**
  - 消费组名称
  - 状态
  - 协议类型
  - 成员数量
  - 总 Lag

- **成员信息**（表格）
  - Member ID
  - Host
  - 分配的分区

- **分区消费详情**（表格）
  - 主题
  - 分区
  - Current Offset
  - Log End Offset
  - Lag
  - 最后提交时间

**UI**:
```
┌────────────────────────────────────────────────────────┐
│ 消费组: my-consumer-group                  状态: STABLE│
├────────────────────────────────────────────────────────┤
│ 成员 (3):                                               │
│ │ consumer-1  (10.0.1.5)  分区: 0,1                    │
│ │ consumer-2  (10.0.1.6)  分区: 2,3                    │
│ │ consumer-3  (10.0.1.7)  分区: 4,5                    │
│                                                         │
│ 消费详情:                                               │
│ 主题          分区  当前Offset  最新Offset  Lag  更新时间│
│ user-events    0      1,234      1,300     66   1分钟前 │
│ user-events    1      2,456      2,500     44   1分钟前 │
│ user-events    2      3,678      3,700     22   2分钟前 │
│                                                         │
│ 操作:                                                   │
│ [重置 Offset]  [删除消费组]                             │
└────────────────────────────────────────────────────────┘
```

### 5.3 重置 Offset
**重置策略**:
- 最早（Earliest）
- 最新（Latest）
- 指定时间戳
- 指定 Offset
- 向前/向后移动 N 条

**UI**:
```
┌────────────────────────────────────────┐
│ 重置 Offset                             │
├────────────────────────────────────────┤
│ 消费组: my-consumer-group               │
│ 主题: user-events                       │
│                                         │
│ 重置策略:                               │
│ ( ) 最早                                │
│ (●) 最新                                │
│ ( ) 指定时间: [选择时间]                │
│ ( ) 指定 Offset: [____]                 │
│ ( ) 向后移动: [____] 条                 │
│                                         │
│ 应用到:                                 │
│ [✓] 分区 0                              │
│ [✓] 分区 1                              │
│ [ ] 分区 2                              │
│                                         │
│ ⚠️ 此操作需要先停止消费者               │
│                                         │
│ [取消]  [确认重置]                      │
└────────────────────────────────────────┘
```

### 5.4 Lag 监控
**功能描述**:
- 实时监控消费组 Lag
- Lag 趋势图表
- Lag 告警

**图表展示**:
- 折线图显示各分区 Lag 变化
- 时间范围选择（1小时、6小时、24小时）
- 自动刷新

---

## 6. 仪表盘

### 6.1 集群概览
**信息展示**:
- Broker 数量和状态
- 主题总数
- 消费组总数
- 每秒消息数（近似）

**UI**:
```
┌────────────────────────────────────────────────────────┐
│ 集群概览: Local Kafka                                   │
├────────────────────────────────────────────────────────┤
│ ┌─────────────┐ ┌─────────────┐ ┌─────────────┐       │
│ │ Broker      │ │ 主题        │ │ 消费组      │       │
│ │     3       │ │    45       │ │    12       │       │
│ └─────────────┘ └─────────────┘ └─────────────┘       │
│                                                         │
│ 最近活动:                                               │
│ │ user-events: 1.2K msg/s                              │
│ │ order-created: 345 msg/s                             │
│ │ payment-log: 89 msg/s                                │
└────────────────────────────────────────────────────────┘
```

### 6.2 快速操作
- 切换连接
- 创建主题
- 发送消息
- 消费消息

---

## 7. 设置和偏好

### 7.1 界面设置
- 主题: 亮色/暗色/跟随系统
- 语言: 中文/English
- 字体大小

### 7.2 行为设置
- 默认消费策略
- 消息自动格式化
- 最大消息显示数量
- 自动重连

### 7.3 安全设置
- 密码保存策略
- SSL 证书管理

---

## 8. 高级功能（未来版本）

### 8.1 Schema Registry 集成
- Schema 列表
- Schema 版本管理
- Avro 消息序列化/反序列化

### 8.2 性能监控
- Broker 性能指标
- 主题吞吐量统计
- 消费组性能分析

### 8.3 消息转换
- 格式转换（JSON ↔ Avro）
- 字段映射
- 数据脱敏

### 8.4 自动化
- 定时任务（定时发送消息）
- 消息转发规则
- Webhook 集成
